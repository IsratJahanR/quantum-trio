<!DOCTYPE html>
{% load static %}
{% load static tailwind_tags %}
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Address</title>
    <link rel="icon" type="image/x-icon" href="{% static 'app/image/favicon.ico' %}" />
    {% tailwind_css %}
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen ">
    <div class="bg-white p-10 rounded-2xl shadow-lg max-w-lg ">
        <div class="flex items-center justify-between mb-6">
            <a href="">
                <img src="{% static "app/image/icon/left-arrow.png" %}" alt="" style="width: 30px; height: 30px;">
            </a>
            <h2 class="text-xl font-bold items-center text-gray-700">Your Address&nbsp;</h2>
            <div class="w-8"></div> <!-- Empty div for spacing balance -->
        </div>
            <form action="" method="POST" id="shopAddressForm">
                <div class="mb-4">
                    <label for="district" class="block text-gray-700 font-bold mb-2">Select Your District *</label>
                    <select id="district" name="district" 
                        class="border border-gray-300 p-2 rounded-lg w-full focus:outline-none focus:border-pink-600" required>
                        <option disabled selected>Select District</option>
                        
                        {% for dist in district %}
                            <option value="{{ dist.name }}">{{ dist.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-4">
                    <label for="upazilla" class="block text-gray-700 font-bold mb-2">Select your upazilla *</label>
                    <select id="upazilla" name="upazilla"
                        class="border border-gray-300 p-2 rounded-lg w-full focus:outline-none focus:border-pink-600"
                        required>
                        <option value="" disabled selected>Select Your Upazilla</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="area" class="block text-gray-700 font-bold mb-2">Your Area *</label>
                    <input type="text" id="area" name="area"
                        class="border border-gray-300 p-2 rounded-lg w-full focus:outline-none focus:border-pink-600"
                        required />
                </div>

                <div class="mb-4">
                    <table>
                        <tr>
                            <td>
                                <label for="latitude" class="block text-gray-700 font-bold mb-2">Latitude *</label>
                            </td>
                            <td>
                                <input type="text" id="latitude" name="latitude"
                                    class="border border-gray-300 p-2 rounded-lg w-full focus:outline-none focus:border-pink-600 mb-2"
                                    required />
                            </td>
                            <td>&nbsp;</td>
                            <td>
                                
                                <label for="longitude" class="block text-gray-700 font-bold mb-2">Longitude *</label>
                            </td>
                            <td>
                                <input type="text" id="longitude" name="longitude"
                                    class="border border-gray-300 p-2 rounded-lg w-full focus:outline-none focus:border-pink-600 mb-2"
                                    required placeholder="" />
                            </td>
                            <td>
                                <button type="button"
                                    class="bg-pink-500 text-white p-2 w-full rounded-lg hover:bg-pink-700 transition duration-300"
                                    onclick="getLocation()">Get My Location</button>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="5" style="color:red">Note: Collect your latitude and longitude by clicking get
                                my location*
                            </td>
                        </tr>
                    </table>
                </div>
                <button type="submit"
                    class="bg-pink-500 text-white p-2 w-1/3 rounded-lg hover:bg-pink-700 transition duration-300">
                    Submit
                </button>
              
            </form>
        
    </div>

    <script>
        function getLocation() {
            // Check if Geolocation is supported
            if (navigator.geolocation) {
                // Get the current position
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                document.getElementById("location").innerHTML = "Geolocation is not supported by this browser.";
            }
        }

        function showPosition(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            document.getElementById("latitude").value = latitude;
            document.getElementById("longitude").value = longitude;
        }

        function showError(error) {
            // Handle errors
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    document.getElementById("location").innerHTML = "User denied the request for Geolocation.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    document.getElementById("location").innerHTML = "Location information is unavailable.";
                    break;
                case error.TIMEOUT:
                    document.getElementById("location").innerHTML = "The request to get user location timed out.";
                    break;
                case error.UNKNOWN_ERROR:
                    document.getElementById("location").innerHTML = "An unknown error occurred.";
                    break;
            }
        }
        const citiesBydistrict = {
            {% for upazilla in Upazilla %}
            "{{ upazilla.district__name }}": [
                {% for index in upazilla.upazilla_names %}
                "{{ index }}"{% if not forloop.last %}, {% endif %}
                {% endfor %}
            ]{% if not forloop.last %}, {% endif %}
            {% endfor %}
        };

        document
            .getElementById("district")
            .addEventListener("change", function () {
                const district = this.value;
                const upazillaSelect = document.getElementById("upazilla");
                upazillaSelect.innerHTML =
                    '<option value="" disabled selected>Select upazilla</option>';

                if (district) {
                    const cities = citiesBydistrict[district];
                    cities.forEach((upazilla) => {
                        const option = document.createElement("option");
                        option.value = upazilla;
                        option.textContent = upazilla;
                        upazillaSelect.appendChild(option);
                    });
                }
            });

        // Initialize and add the map
        function initMap() {
            const map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 23.8103, lng: 90.4125 },
                zoom: 8,
            });

            const marker = new google.maps.Marker({
                position: { lat: 23.8103, lng: 90.4125 },
                map: map,
                draggable: true,
            });

            google.maps.event.addListener(marker, "position_changed", function () {
                const lat = marker.getPosition().lat();
                const lng = marker.getPosition().lng();
                document.getElementById("latitude").value = lat;
                document.getElementById("longitude").value = lng;
            });

            google.maps.event.addListener(map, "click", function (event) {
                marker.setPosition(event.latLng);
            });
        }
    </script>
    </body>

</html>